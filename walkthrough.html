<!DOCTYPE html>
<html>
	<head>
		<title>Documentation</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<link rel="icon" type="image/png" href="images/favicon.png">

		<link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
		<link href="css/screen.css" rel="stylesheet" media="screen">
		<link href="css/style.css" rel="stylesheet" media="screen">

		<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
		<script src="http://cdn.pubnub.com/pubnub-3.5.1.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/function.js"></script>

	</head>

	<body>
		<header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav" role="banner">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar">&nbsp;</span>
						<span class="icon-bar">&nbsp;</span>
						<span class="icon-bar">&nbsp;</span>
					</button>
					<a class="navbar-brand" href="index.html"> <img src="images/logo.png"/> </a>
				</div>

				<nav class="collapse navbar-collapse navbar-ex1-collapse">
					<ul class="top-link nav navbar-nav navbar-right">
						<li>
							<a href="index.html">Home</a>
						</li>
						<li>
							<a href="document.html">Documentation</a>
						</li>
						<li>
							<a href="walkthrough.html"  style="color: #FFFFFF">Walkthrough</a>
						</li>
					</ul>
				</nav>
			</div>
		</header>

		<!-- CONTENT -->
		<div id="content">
			<div class="content-area" style="padding-top: 0">
				<div class="container">
					<div class="span6">
				        <div class="highlight highlight-html">
				        	<p>
				        		<h3>You can understand and make it yourself the PubChat using below sample code.</h3>
				        	</p>
				        	<p>
					        	<b style="color: red;">Note : </b>Create own <code style="height:30px; width: 50px;">*.js</code> in your "js" folder.
					        	&nbsp;&nbsp;Replace following code in your js file.<br />
					        	Finally, type the following script code in your Home Page.
					        </p>
							<pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/YourFileName.js"</span><span class="nt">&gt;&lt;/script&gt;</span></pre>
						</div>
						
						<div class="highlight highlight-html">
				        	<p>
					        	Here is the full source code for PubChat:
					        </p>
					        <br />
					        <p style="color: blue">
					        	Index.html
					        </p>
							<pre><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://code.jquery.com/jquery-1.8.2.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdn.pubnub.com/pubnub-3.5.1.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"js/function.js"</span><span class="nt">&gt;&lt;/script&gt;</span><br />
<span class="nt">&lt;body&gt;</span>
<span class="c">&lt;! -- ======================= --&gt;</span><br />
<span class="c">&lt;! -- Home Page --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"homePage"</span> <span class="na">class=</span><span class="s">"type-home"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;label&gt;</span>Your Name<span class="nt">&lt;/label&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Name"</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">id=</span><span class="s">"username"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">id=</span><span class="s">"startchatButton"</span> <span class="na">class=</span><span class="s">"button"</span><span class="nt">&gt;</span>Start Chatting!<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="c">&lt;! -- /Home Page --&gt;</span><br />
<span class="c">&lt;! -- Chat List Page --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"chatListPage"</span> <span class="na">class=</span><span class="s">"type-chat-list"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">placeholder=</span><span class="s">"Chat Room Name"</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">id=</span><span class="s">"chatRoomName"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"newChat"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">id=</span><span class="s">"newhatButton"</span> <span class="na">class=</span><span class="s">"button"</span><span class="nt">&gt;</span>Join New Chat<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;h1</span><span class="nt">&gt;</span>Current Chat Rooms<span class="nt">&lt;/h1</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"chatList"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/ul</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="c">&lt;! -- /Chat List Page --&gt;</span><br />
<span class="c">&lt;! -- Chat Page --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"chatPage"</span> <span class="na">class=</span><span class="s">"type-interior"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content-primary"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h1&gt;</span>&nbsp;<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"messageList"</span><span class="nt">&gt;</span>
    	<span class="nt">&lt;/ul</span><span class="nt">&gt;</span>
    	<span class="nt">&lt;textarea</span> <span class="na">id=</span><span class="s">"messageContent"</span><span class="nt">&gt;</span>
    	<span class="nt">&lt;/textarea</span><span class="nt">&gt;</span>
    	<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"ui-grid ui-block"</span><span class="nt">&gt;</span>
    	    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">id=</span><span class="s">"backButton"</span> <span class="na">class=</span><span class="s">"button"</span><span class="nt">&gt;</span>Chat Rooms<span class="nt">&lt;/a&gt;</span>
    	    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">id=</span><span class="s">"sendMessageButton"</span> <span class="na">class=</span><span class="s">"button"</span><span class="nt">&gt;</span>Send Message<span class="nt">&lt;/a&gt;</span>
    	<span class="nt">&lt;/div</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content-secondary"</span><span class="nt">&gt;</span>
    	<span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"userList"</span><span class="nt">&gt;</span>
    	<span class="nt">&lt;/ul</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="c">&lt;! -- /Chat Page --&gt;</span><br />
<span class="c">&lt;! -- Delete Confirm PopUp Page --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"popup_box"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>&nbsp;<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Would you like to delete this room?<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#cancel"</span> <span class="na">id=</span><span class="s">"close"</span> <span class="na">class=</span><span class="s">"button"</span><span class="nt">&gt;</span>Cancel<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#yes"</span> <span class="na">id=</span><span class="s">"yes"</span> <span class="na">class=</span><span class="s">"button"</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="c">&lt;! -- /Delete Confirm PopUp Page --&gt;</span><br />
<span class="c">&lt;! -- ======================= --&gt;</span>
<span class="nt">&lt;body&gt;</span></pre>
							<br />
							<p style="color: blue">
					        	function.js
					        </p>
							<pre>$(<span class="nt">document</span>).ready(<span class="kd">function</span>() {
    <span class="kd">function</span> PubNub<span class="p">() {</span>
        <span class="nt">this</span>.publishKey <span class="o">=</span> <span class="s1">'pub-c-8781d89b-1000-422d-b6ec-b75340d087bc'</span><span class="p">;</span>
        <span class="nt">this</span>.subscribeKey <span class="o">=</span> <span class="s1">'sub-c-fda9bb42-b75a-11e2-bc76-02ee2ddab7fe'</span><span class="p">;</span>
        <span class="nt">this</span>.subscriptions <span class="o">=</span> localStorage[<span class="s1">"pn-subscriptions"</span>] || [];<br />
        <span class="k">if</span> (<span class="k">typeof</span> <span class="nt">this</span>.subscriptions <span class="o">==</span> <span class="s1">"string"</span>) {
            <span class="nt">this</span>.subscriptions <span class="o">=</span> <span class="nt">this</span>.subscriptions.split(<span class="s1">","</span>);
        }
        <span class="nt">this</span>.subscriptions <span class="o">=</span> $.unique(<span class="nt">this</span>.subscriptions);
    }<br />
    PubNub.connect = <span class="kd">function</span><span class="o">(</span><span class="s1">username</span><span class="kd">) {</span>
        <span class="nt">this</span>.username = username;
        <span class="nt">this</span>.connection = <span class="kd">PUBNUB</span>.init<span class="p">({</span>
        	publish_key <span class="o">:</span> <span class="nt">this</span>.publishKey<span class="p">,</span>
        	subscribe_key <span class="o">:</span> <span class="nt">this</span>.subscribeKey<span class="p">,</span>
    	    uuid <span class="o">:</span> <span class="nt">this</span>.username
        <span class="p">});</span>
    <span class="p">};</span><br />
    PubNub.addSubscription = <span class="kd">function</span><span class="o">(</span><span class="s1">channel</span><span class="kd">) {</span>
        <span class="nt">this</span>.subscriptions.push(channel);
        <span class="nt">this</span>.subscriptions = $.unique(<span class="nt">this</span>.subscriptions);
    <span class="p">};</span><br />
    PubNub.removeSubscription = <span class="kd">function</span><span class="o">(</span><span class="s1">channel</span><span class="kd">) {</span>
        <span class="k">if</span> (<span class="nt">this</span>.subscriptions.indexOf(channel) !== <span class="mi">-1</span><span>) {</span>
            <span class="nt">this</span>.subscriptions.splice(<span class="nt">this</span>.subscriptions.indexOf(channel), <span class="mi">1</span>);
        <span class="p">}</span>
        <span class="nt">this</span>.saveSubscriptions();
    <span class="p">};</span><br />
    PubNub.saveSubscriptions = <span class="kd">function</span><span class="o">() {</span>
        localStorage["pn-subscriptions"] = <span class="nt">this</span>.subscriptions;
    <span class="p">};</span><br />
    PubNub.subscribe = <span class="kd">function</span><span class="o">(</span><span class="s1">options</span><span class="kd">) {</span>
        <span class="nt">this</span>.connection.subscribe.apply(<span class="nt">this</span>.connection, arguments);
        <span class="nt">this</span>.addSubscription(options.channel);
        <span class="nt">this</span>.saveSubscriptions();
    <span class="p">};</span><br />
    PubNub.unsubscribe = <span class="kd">function</span><span class="o">(</span><span class="s1">options</span><span class="kd">) {</span>
        <span class="nt">this</span>.connection.unsubscribe.apply(<span class="nt">this</span>.connection, arguments);
    <span class="p">};</span><br />
    PubNub.publish = <span class="kd">function</span><span class="o">() {</span>
        <span class="nt">this</span>.connection.publish.apply(<span class="nt">this</span>.connection, arguments);
    <span class="p">};</span><br />
    PubNub.history = <span class="kd">function</span><span class="o">() {</span>
        <span class="nt">this</span>.connection.history.apply(<span class="nt">this</span>.connection, arguments);
    <span class="p">};</span><br />
    <span class="kd">var</span> chatChannel = <span class="s1">''</span>, username = <span class="s1">''</span>, users = [],
        usernameInput = $(<span class="s">"#username"</span>),
        chatRoomName = $(<span class="s">"#chatRoomName"</span>),
        chatButton = $(<span class="s">"#startChatButton"</span>),
        newChatButton = $(<span class="s">"#newChatButton"</span>),
        chatListEl = $(<span class="s">"#chatList"</span>),
        sendMessageButton = $(<span class="s">"#sendMessageButton"</span>),
        backButton = $(<span class="s">"#backButton"</span>),
        messageList = $(<span class="s">"#messageList"</span>),
        messageContent = $(<span class="s">"#messageContent"</span>),
        userList = $(<span class="s">"#userList"</span>),
        pubnub = <span class="kd">new</span> PubNub(),
        isBlurred = <span class="mi">false</span>,
        timerId = <span class="mi">-1</span>,
        pages = {
            home : $(<span class="s">"#homePage"</span>),
            chatList : $(<span class="s">"#chatListPage"</span>),
            chat : $(<span class="s">"#chatPage"</span>),
            deleteRoom : $(<span class="s">"#delete"</span>)
        };<br />
    <span class="kd">var</span> currentView = <span class="kd">new</span> HomeView();<br />
    <span class="c">// Home View</span>
    <span class="kd">function</span> HomeView() {
    	<span class="kd">if</span> (localStorage[<span class="s1">"username"</span>]) {
            usernameInput.val(localStorage[<span class="s1">"username"</span>]);
        }<br />
        chatButton.off(<span class="s1">'click'</span>);
        chatButton.click(<span class="kd">function</span> (event) {
            <span class="kd">if</span> (usernameInput.val() <span class="kd">!=</span> <span class="s1">''</span>) {
            	username = usernameInput.val();
            	localStorage[<span class="s1">"username"</span>] = username;
            	pubnub.connect(username);<br />
            	$(<span class="s1">'#homePage'</span>).hide();
            	ChatListView();
            } <span class="kd">else</span> {
            	alert(<span class="s1">"Enter Your Name"</span>);
            }
        <span class="p">});</span>
    <span class="p">};</span><br />
    <span class="c">// Chat List View</span>
    <span class="kd">function</span> ChatListView(event, data) {
    	$(<span class="s1">'#chatListPage'</span>).show();<br />
    	<span class="kd">if</span> ($(<span class="s1">'#chatRoomName'</span>).val() <span class="kd">!=</span> <span class="s1">""</span>)
    	    $(<span class="s1">'#chatRoomName'</span>).val(<span class="s1">""</span>);<br />
    	chatListEl.empty();<br />
    	<span class="kd">for</span> (<span class="kd">var</span> i = <span class="mi">0</span>; i &lt; pubnub.subscriptions.length; i++) {
    	    <span class="kd">var</span> chatName = pubnub.subscriptions[i],
    	        chatEl = $(<span class="s1">"&lt;li&gt;&lt;a href='#chatPage' id='"</span> 
    	               + chatName + <span class="s1">"' class='room-button'&gt;"</span>
    	               + chatName + <span class="s1">"&lt;/a&gt;&lt;a href='#delete' id='del-"</span>
    	               + chatName + <span class="s1">"' class='button delete'&gt;delete&lt;/a&gt;&lt;/li&gt;"</span>);<br />
    	    chatListEl.append(chatEl);
    	}<br />
    	newChatButton.off(<span class="s1">'click'</span>);
        newChatButton.click(<span class="kd">function</span> (event) {
            <span class="kd">if</span> (chatRoomName.val() <span class="kd">!==</span> <span class="s1">''</span>) {
                chatChannel = chatRoomName.val();<br />
                $(<span class="s1">'#chatListPage'</span>).hide();
    	        ChatView();
    	    }
    	<span class="p">});</span><br />
    	$(<span class="s1">'.room-button'</span>).off(<span class="s1">'click'</span>);
        $(<span class="s1">'.room-button'</span>).click(<span class="kd">function</span> () {
            chatChannel = $(<span class="nt">this</span>).attr(<span class="s1">'id'</span>);
            $(<span class="s1">'#chatListPage'</span>).hide();
    	    ChatView();
        });<br />
        $(<span class="s1">'.delete'</span>).off(<span class="s1">'click'</span>);
        $(<span class="s1">'.delete'</span>).click(<span class="kd">function</span> () {
            chatChannel = $(<span class="nt">this</span>).attr(<span class="s1">'id'</span>).substring(<span class="mi">4</span>);<br />
            <span class="kd">var</span> left = ($(window).width() - $(<span class="s1">'#popup_box'</span>).width() - <span class="mi">34</span>) / <span class="mi">2</span>;
            $(<span class="s1">'#popup_box'</span>).css(<span class="s1">'left'</span>, left);
            
            DeleteChatView();
        });
    };<br />
    <span class="c">// Delete Chat View</span>
    <span class="kd">function</span> DeleteChatView(event, data) {
    	<span class="kd">var</span> channelName = chatChannel;<br />
    	$(<span class="s1">'#popup_box label'</span>).text(<span class="s1">'Room Name : "'</span> + channelName + <span class="s1">'"'</span>);
    	loadPopupBox();<br />
    	$(<span class="s1">'#yes'</span>).off(<span class="s1">'click'</span>);
    	$(<span class="s1">'#yes'</span>).click(function() {
    	    pubnub.removeSubscription(channelName);
    	    unloadPopupBox();
    	    ChatListView();
        });
    };<br />
    <span class="kd">function</span> unloadPopupBox() {
    	$(<span class="s1">'#popup_box'</span>).fadeOut(<span class="s1">"slow"</span>);
    }<br />
    <span class="kd">function</span> loadPopupBox() {
    	$(<span class="s1">'#popup_box'</span>).fadeIn(<span class="mi">50</span>);
    }<br />
    <span class="c">// Chatting View</span>
    <span class="kd">function</span> ChatView(event, data) {
    	$(<span class="s1">'#chatPage'</span>).show();<br />
        var self = <span class="nt">this;</span>
            users = [];
        messageList.empty();
        userList.empty();<br />
        pubnub.unsubscribe({
            channel: chatChannel        	
        });<br />
        pubnub.subscribe({
            channel: chatChannel,
            message: self.handleMessage,
            presence   : <span class="kd">function</span>( message, env, channel ) {
            	<span class="kd">if</span> (message.action == <span class="s1">"join"</span>) {
            		users.push(message.uuid);
            		userList.append(<span class="s1">"&lt;li data-username='"</span> + message.uuid 
            		              + <span class="s1">"'&gt;"</span> + message.uuid + <span class="s1">"&lt;/li&gt;"</span>);
            	} else {
            		users.splice(users.indexOf(message.uuid), <span class="mi">1</span>);
            		userList.find(<span class="s1">'[data-username="'</span> + message.uuid + <span class="s1">'"]'</span>).remove();
            	}<br />
                userList.listview(<span class="s1">'refresh'</span>);
            }
        });<br />
        pages.chat.find(<span class="s1">"h1:first"</span>).text(chatChannel);<br />
        pubnub.history({
            channel : chatChannel,
            limit : <span class="mi">100</span>
        }, <span class="kd">function</span> (messages) {
            messages = messages[<span class="mi">0</span>];
            messages = messages || [];<br />
            <span class="kd">for</span> (<span class="kd">var</span> i = <span class="mi">0</span>; i &lt; messages.length; i++) {
            	ChatView.prototype.handleMessage(messages[i], <span class="mi">false</span>);
            }<br />
            users.push(usernameInput);
            userList.append(<span class="s1">"&lt;li&gt;"</span> + usernameInput.val() + <span class="s1">"&lt;/li&gt;"</span>);<br />
            $(<span class="nt">document</span>).scrollTop($(document).height());
        });<br />
        messageContent.off(<span class="s1">'keydown'</span>);
        messageContent.bind(<span class="s1">'keydown'</span>, <span class="kd">function</span> (event) {
            <span class="kd">if</span> ((event.keyCode || event.charCode) !== <span class="mi">13</span>) return <span class="mi">true</span>;
            sendMessageButton.click();
            return <span class="mi">false;</span>
        });<br />
        sendMessageButton.off(<span class="s1">'click'</span>);
        sendMessageButton.click(<span class="kd">function</span> (event) {
            var message = messageContent.val();<br />
            <span class="kd">if</span> ($.trim(message).length > <span class="mi">0</span>) {
                pubnub.publish({
                    channel : chatChannel,
                    message : {
                        username : username,
                        text : message
                    }
                });<br />
                var message = {
                    username : username,
                    text : message
                }<br />
                ChatView.prototype.handleMessage(message, <span class="mi">true</span>);<br />
                messageContent.val(<span class="s1">""</span>);
            }
        });<br />
        backButton.off(<span class="s1">'click'</span>);
        backButton.click(<span class="kd">function</span> (event) {
            pubnub.unsubscribe({
                channel : chatChannel
            });<br />
            pages.chat.hide();<br />
            ChatListView();
        });
    };<br />
    ChatView.prototype.handleMessage = <span class="kd">function</span> (message, animate) {
    	if (animate !== <span class="mi">false</span>) animate = <span class="mi">true;</span><br />
    	var messageEl = $(<span class="s1">"&lt;li class='message'&gt;"</span>
    	                + <span class="s1">"&lt;span class='username'&gt;"</span>
    	                + message.username
    	                + <span class="s1">"&lt;/span>&nbsp;:&nbsp;"</span>
    	                + message.text + <span class="s1">"&lt;/li&gt;"</span>);
    	messageList.append(messageEl);<br />
    	<span class="kd">if</span> (animate === <span class="mi">true</span>) {
    	    $(<span class="s1">"html, body"</span>).animate({scrollTop: $(<span class="nt">document</span>).height() - $(window).height()}, <span class="s1">'slow'</span>);
    	}
    };
<span class="p">});</span></pre>
						</div>
					</div>					
				</div>
			</div>
		</div>
		<!-- /CONTENT -->
	</body>
</html>
